<?php

if (function_exists('dol_getprefix') && !function_exists('__tickets_redirect_loaded')) {
	define('__tickets_redirect_loaded', true);
	
	if (basename($_SERVER['SCRIPT_NAME'] ?? '') === 'card.php' && 
	    strpos($_SERVER['SCRIPT_NAME'] ?? '', 'ticket/') !== false) {
		
		$action = GETPOST('action', 'alpha');
		$fk_project = GETPOST('fk_project', 'int');
		
		if ($action === 'create' && empty($fk_project)) {
			header('Location: '.DOL_URL_ROOT.'/custom/tickets/select_project.php', true, 302);
			exit(0);
		}
	}
}
